{% extends "main/base.html" %}

{% block title %}The News Blog{% endblock %}
{% load staticfiles %}
{% block css %}
    {{ block.super }}
    <link href="{% static "blog/css/style.css" %}" rel="stylesheet" media="screen">
{% endblock %}

{% block content %}
    {% load staticfiles %}
<div ng-init='init={}; init.page={{ page }}; init.articles={{ article_list_json }}'>
  <div ng-controller='ArticleCtrl'>
     {% verbatim %}
   <!-- Carousel
 ================================================== -->
<div id="myCarousel" class="carousel slide" >
  <div class="carousel-inner" ng-cloak>

    <div ng-repeat="article in data.articles|limitTo:4"  ng-class="{active : $first, item : true}">
      <img src="/static/blog/slide-01.jpg" alt="">
      <div class="container">
        <div class="carousel-caption">
          <h1>{{article.title}}</h1>
          <p class="lead">{{article.summary}}</p>
          <a class="btn btn-large btn-primary" href="/static/blog/{{article.slug}}">Read more</a>
        </div>
      </div>
    </div>

  </div>
  <a class="left carousel-control" ref="#myCarousel" data-slide="prev">‹</a>
  <a class="right carousel-control" href="#myCarousel" data-slide="next">›</a>
</div> <!-- /.carousel -->

<div class="featurette container">
 <div class="row">
 

  <div id="sidebar" class="span2 bs-docs-sidebar">
    <ul class="nav nav-list bs-docs-sidenav affix">
      <li ng-repeat="article in data.articles" ifchanged="{{article.date}}">
        <i class="icon-chevron-right"></i>
        <a href="#{{article.date}}">{{article.date | date:'EEEE, MMM d'}}</a>
      </li>
    </ul>
  </div>

  <div id="articles" class="span9" ng-cloak>
  
   <div ng-repeat="article in data.articles">
    <div ifchanged="{{article.date}}" >
      <span class="label label-inverse">{{article.date | date:'fullDate'}}</span><br /><br />
   </div>
    <section id="{{article.date}}" >
      <div class="container">
        <div class="well well-small">
          <h1>{{article.title}}</h1>
          <p class="lead">{{article.summary}}</p>
          <p>{{article.time}}</p>
          <a class="btn btn-large btn-primary" href="/blog/{{article.slug}}">Read more</a>
        </div>
      </div>
    </section>
   </div>
  {% endverbatim %}
  </div>
 </div>
</div>
{% endblock %}
{% block script %}
  <script src="http://code.angularjs.org/1.1.5/angular.min.js"></script>
    {{ block.super }}
  {% verbatim %}
    <script type="text/javascript">
    var mod = angular.module("newsblog", []);

    // intended to work with ng-repeat.
    // attr.ifchanged must be evaluated in the html attribute with <element ifchanged="{{myVar}}">.
    mod.directive('ifchanged', function() {
    	
    	var changed;
    	return function(scope, element, attrs) {

   			if (changed !== attrs.ifchanged || scope.$first) {
   				changed = attrs.ifchanged;
   			} else {
   				element.remove();
   			}
    	}
    });
    
    mod.controller('ArticleCtrl', function ($scope) {
    	
    	console.log($scope.init.articles);
    	$scope.data = {
    		page : $scope.init.page,
    		articles : $scope.init.articles,
    		end : false
    	}
    });
    
    $(function() {
    	
    	// init carousel
        $('.carousel').carousel({
          interval: 10000
        });
    	
        // init scrollspy sidebar
        $('body').scrollspy({
            offset: 82,
            target: '#sidebar'
        });
        $('#sidebar').scrollspy('refresh');
        	
        $('#sidebar li:last-child').removeClass('active');
        $('#sidebar li:first-child').addClass('active');
        
        var offset = 80;

        $('#sidebar li a').click(function(event) {
            event.preventDefault();
            var cssId = $(this).attr('href');
            $(cssId)[0].scrollIntoView();
            scrollBy(0, -offset);
            history.pushState(null, null, cssId);
        });
    });
    </script>
  {% endverbatim %}
  </div>
</div>
{% endblock %}
